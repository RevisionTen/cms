{% extends '@EasyAdmin/default/layout.html.twig' %}
{% import _self as macros %}
{% macro groupedEvents(eventObjects) %}
    <table class="table datagrid border-0">
        {% for userId, aggregates in eventObjects %}
            <tr>
                <td style="width: 4rem;padding-right: 0;vertical-align: top;">
                    {% set value = userId %}
                    <div class="pt-1">
                        {% include '@cms/Admin/User/List/medium.html.twig' %}
                    </div>
                </td>
                <td>
                    {% for aggregateUuid, events in aggregates %}
                        <div class="{{ loop.last == false ? 'mb-3' }}">
                            <strong>
                                {% set value = aggregateUuid %}{% include '@cms/Admin/User/List/uuid.html.twig' %}
                            </strong>
                            {% for event in events|slice(0, 3) %}
                                {% set groupedEvent = {} %}
                                <div class="row mb-1 text-muted">
                                    <div class="col">
                                        {{ event.payload.message is defined ? event.payload.message|trans : event.message|trans }}
                                    </div>
                                    <div class="col text-right">
                                        {% set value = event.created %}{% include '@cms/Admin/Event/List/datetime_ago.html.twig' %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endfor %}
                </td>
            </tr>
        {% endfor %}
    </table>
{% endmacro %}

{% block content_title %}
    {{ 'admin.label.dashboard'|trans({}, 'cms') }}
{% endblock %}

{% block body_class %}dashboard{% endblock %}

{% block main %}
<div class="p-3">
    <div class="row align-items-stretch">
        <div class="col col-sm-6 d-flex flex-column">

            {% if pageEvents|length > 0 %}
                <div class="flex-grow-1 card mb-3 border-0">
                    <div class="card-header p-3 border-0 bg-transparent">
                        <h6>
                            {{ 'admin.label.latestCommits'|trans({}, 'cms') }}
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        {{ macros.groupedEvents(pageEvents) }}
                    </div>
                </div>
            {% endif %}

            {% if nonPageEvents|length > 0 and is_granted('event_list') %}
                <div class="flex-grow-1 card mb-3 border-0">
                    <div class="card-header p-3 border-0 bg-transparent">
                        <h6>
                            {{ 'admin.label.latestNonPageEvents'|trans({}, 'cms') }}
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        {{ macros.groupedEvents(nonPageEvents) }}
                    </div>
                </div>
            {% endif %}

        </div>

        <div class="col col-sm-6 d-flex flex-column">
            <div class="flex-grow-1 card mb-3 border-0">
                <div class="card-header p-3 border-0 bg-transparent">
                    <h6>
                        {{ 'admin.label.systemInformation'|trans({}, 'cms') }}
                    </h6>
                </div>
                <div class="card-body p-0">
                    <table class="table datagrid border-0">
                        <tr>
                            <td><span class="fas fa-pencil-ruler"></span> CMS Version: </td>
                            <td>{{ cms_version }}</td>
                        </tr>
                        <tr>
                            <td><img style="height: 1em;" class="svg-inline--fa" src="{{ asset('/bundles/cms/icons/symfony.svg') }}"> Symfony Version: </td>
                            <td>{{ symfony_version }}</td>
                        </tr>
                        <tr>
                            <td><span class="fab fa-php"></span> PHP Version: </td>
                            <td>{{ php_version }}</td>
                        </tr>
                        <tr>
                            <td><span class="fas fa-microchip"></span> PHP Memory Limit: </td>
                            <td>{{ memory_limit }}</td>
                        </tr>
                        <tr>
                            <td><span class="fas fa-upload"></span> PHP Upload Max File Size: </td>
                            <td>{{ upload_limit }}</td>
                        </tr>
                        <tr>
                            <td><span class="fas fa-upload"></span> PHP Post Max Size: </td>
                            <td>{{ post_limit }}</td>
                        </tr>
                        <tr>
                            <td><span class="fas fa-hourglass-half"></span> PHP Max Execution Time: </td>
                            <td>{{ execution_limit }} sec</td>
                        </tr>
                        {% set iconEnabled = '<span class="fas fa-check text-success"></span>' %}
                        {% set iconDisabled = '<span class="fas fa-times text-danger"></span>' %}
                        <tr>
                            <td><span class="fas fa-rocket"></span> PHP Acceleration: </td>
                            <td>{{ (apc_enabled ? iconEnabled : iconDisabled)|raw }}</td>
                        </tr>
                        <tr>
                            <td><span class="fas fa-file"></span> Page Cache: </td>
                            <td>{{ (cache_enabled ? iconEnabled : iconDisabled)|raw }}</td>
                        </tr>
                        <tr>
                            <td><span class="fas fa-info-circle"></span> Server IP: </td>
                            <td>{{ server_ip }}</td>
                        </tr>
                        <tr>
                            <td><span class="fas fa-database"></span> Database: </td>
                            <td>{{ database_name }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block content_footer_wrapper %}
    {# Replace with nothing, because the footer is not needed here. #}
{% endblock %}
